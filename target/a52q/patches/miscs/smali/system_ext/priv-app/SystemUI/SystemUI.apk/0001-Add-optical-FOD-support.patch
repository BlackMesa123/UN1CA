From 4fcc393a8e2c927851382479f048d5d3687e46c5 Mon Sep 17 00:00:00 2001
From: BlackMesa123 <giangrecosalvo9@gmail.com>
Date: Thu, 7 Dec 2023 00:39:51 +0100
Subject: [PATCH] Add optical FOD support

---
 .../keyguard/KeyguardSecUpdateMonitor.smali   |   6 +
 ...nitorImpl$$ExternalSyntheticLambda13.smali |  33 +-
 .../KeyguardSecUpdateMonitorImpl.smali        | 465 +++++++++++++++---
 smali/com/android/systemui/LsRune.smali       |   6 +-
 .../plugin/PluginFaceWidgetManager.smali      |   6 +-
 .../features/GlobalActionFeatures.smali       |  35 +-
 ...ewMediator$$ExternalSyntheticLambda3.smali |  39 +-
 ...ewMediator$$ExternalSyntheticLambda6.smali | 441 +++++++++--------
 ...ationShadeWindowControllerHelperImpl.smali |  34 +-
 .../statusbar/phone/CentralSurfacesImpl.smali |  61 ++-
 .../phone/SecLsScrimControlHelper$1.smali     |   6 +-
 .../phone/SecLsScrimControlHelper.smali       |   8 +-
 .../phone/StatusBarKeyguardViewManager.smali  |   6 +-
 .../android/systemui/util/DeviceState.smali   |  34 +-
 ...Controller$$ExternalSyntheticLambda1.smali |   6 +-
 ...Controller$$ExternalSyntheticLambda7.smali |   6 +-
 .../KeyguardWallpaperController$2.smali       |   6 +-
 .../KeyguardWallpaperController$4.smali       |  12 +-
 .../KeyguardWallpaperController.smali         |  36 +-
 .../view/KeyguardAnimatedWallpaper.smali      |   6 +-
 .../view/KeyguardImageWallpaper.smali         |   6 +-
 .../view/KeyguardVideoWallpaper.smali         |  12 +-
 22 files changed, 900 insertions(+), 370 deletions(-)

diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
index a898785b..0dd3d45e 100644
--- a/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
@@ -790,6 +790,12 @@
     return-void
 .end method
 
+.method public removeMaskViewForOpticalFpSensor()V
+    .locals 0
+
+    return-void
+.end method
+
 .method public requestSessionClose()V
     .locals 0
 
diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13.smali
index 7b8d92f4..982bc93f 100644
--- a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13.smali
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13.smali
@@ -70,10 +70,41 @@
     :goto_0
     invoke-virtual {p0, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->updateFingerprintListeningState(I)V
 
-    sget-object p0, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
+    if-eqz p1, :cond_3
+
+    iget-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
+
+    invoke-virtual {p1}, Lcom/android/systemui/util/SettingsHelper;->isOneHandModeRunning()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_2
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    goto :goto_1
+
+    :cond_2
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardUpdateMonitor;->isFingerprintDetectionRunning()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_3
+
+    iget-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-nez p1, :cond_3
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_3
+    :goto_1
     return-void
 
+    nop
+
     :pswitch_data_0
     .packed-switch 0x0
         :pswitch_0
diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
index b818096c..3d59c98b 100644
--- a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
@@ -74,6 +74,8 @@
 
 .field public mFpInDisplayState:I
 
+.field public mFpMaskToken:Landroid/os/IBinder;
+
 .field public final mFpMessages:Ljava/util/concurrent/ConcurrentLinkedQueue;
 
 .field public final mFpMsgConsumer:Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda10;
@@ -485,6 +487,8 @@
 
     iput v4, v2, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpInDisplayState:I
 
+    iput-object v1, v2, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
     iput-boolean v4, v2, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mIsShortcutLaunchInProgress:Z
 
     iput-boolean v4, v2, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mIsPanelExpandingStarted:Z
@@ -974,6 +978,41 @@
     return-void
 .end method
 
+.method public final addMaskViewForOpticalFpSensor()V
+    .locals 2
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-nez v0, :cond_0
+
+    const-string v0, "KeyguardFingerprint"
+
+    const-string/jumbo v1, "semAddMaskView()"
+
+    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    invoke-virtual {v0}, Landroid/hardware/fingerprint/FingerprintManager;->semAddMaskView()Landroid/os/IBinder;
+
+    move-result-object v0
+
+    iput-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    const/4 v0, 0x1
+
+    const/4 v1, 0x3
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->setFocusForBiometrics(IZ)V
+
+    :cond_0
+    return-void
+.end method
+
 .method public final clearESimRemoved()V
     .locals 2
 
@@ -4695,18 +4734,23 @@
     goto :goto_0
 
     :cond_0
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_1
     :goto_0
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_2
 
     iget v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
     const/4 v1, 0x1
 
-    if-ne v0, v1, :cond_1
+    if-ne v0, v1, :cond_2
 
     const-string v0, "KeyguardFingerprint"
 
@@ -4716,7 +4760,7 @@
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
-    :cond_1
+    :cond_2
     new-instance v0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda19;
 
     const/4 v1, 0x0
@@ -4739,11 +4783,11 @@
 
     sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_SUB_DISPLAY_COVER:Z
 
-    if-eqz p1, :cond_2
+    if-eqz p1, :cond_3
 
     iput-boolean v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mNeedSubBioAuth:Z
 
-    :cond_2
+    :cond_3
     return-void
 .end method
 
@@ -5173,9 +5217,33 @@
     return-void
 
     :cond_0
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_2
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->is2StepVerification()Z
+
+    move-result v0
+
+    if-nez v0, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isForcedLock()Z
+
+    move-result v0
+
+    if-nez v0, :cond_1
+
+    iget-boolean v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-nez v0, :cond_2
+
+    :cond_1
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_2
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_SUB_DISPLAY_COVER:Z
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_3
 
     iput-boolean v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mForceStartFinger:Z
 
@@ -5183,7 +5251,7 @@
 
     iput-boolean v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mNeedSubWofFpAuth:Z
 
-    :cond_1
+    :cond_3
     invoke-super {p0, p1, p2}, Lcom/android/keyguard/KeyguardUpdateMonitor;->handleFingerprintAuthenticated(IZ)V
 
     return-void
@@ -5237,7 +5305,7 @@
     :cond_2
     const/16 v0, 0x3ea
 
-    if-eq v0, p1, :cond_5
+    if-eq v0, p1, :cond_6
 
     const/16 v0, 0x3eb
 
@@ -5248,13 +5316,15 @@
     :cond_3
     const/16 v0, 0x3e9
 
-    if-ne v0, p1, :cond_4
+    if-ne v0, p1, :cond_5
+
+    sget-boolean p2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    sget-object p2, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    if-eqz p2, :cond_4
 
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
-    const v0, 0x7f130828
+    const v0, 0x7f130825
 
     invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
 
@@ -5263,9 +5333,20 @@
     goto :goto_1
 
     :cond_4
+    iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
+
+    const v0, 0x7f130828
+
+    invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
+
+    move-result-object p2
+
+    goto :goto_1
+
+    :cond_5
     const/16 v0, 0x3ed
 
-    if-ne v0, p1, :cond_6
+    if-ne v0, p1, :cond_7
 
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
@@ -5277,7 +5358,7 @@
 
     goto :goto_1
 
-    :cond_5
+    :cond_6
     :goto_0
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
@@ -5287,7 +5368,7 @@
 
     move-result-object p2
 
-    :cond_6
+    :cond_7
     :goto_1
     iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mPowerManager:Landroid/os/PowerManager;
 
@@ -5301,21 +5382,21 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_BACKGROUND_AUTHENTICATION:Z
 
-    if-eqz v0, :cond_7
+    if-eqz v0, :cond_8
 
     const/4 v0, 0x5
 
-    if-ne p1, v0, :cond_7
+    if-ne p1, v0, :cond_8
 
     iget-boolean v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardOccluded:Z
 
-    if-eqz v0, :cond_7
+    if-eqz v0, :cond_8
 
     iget v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
     const/4 v3, 0x1
 
-    if-ne v0, v3, :cond_7
+    if-ne v0, v3, :cond_8
 
     const-string v0, "mIsFPCanceledByForegroundApp true"
 
@@ -5325,7 +5406,7 @@
 
     invoke-virtual {p0, v1}, Lcom/android/keyguard/KeyguardUpdateMonitor;->setFingerprintRunningState(I)V
 
-    :cond_7
+    :cond_8
     invoke-super {p0, p1, p2}, Lcom/android/keyguard/KeyguardUpdateMonitor;->handleFingerprintError(ILjava/lang/String;)V
 
     return-void
@@ -10784,59 +10865,209 @@
 .end method
 
 .method public final isInDisplayFingerprintMarginAccepted()Z
-    .locals 3
+    .locals 6
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->is2StepVerification()Z
 
     move-result v0
 
-    const/4 v1, 0x1
+    const/4 v1, 0x0
+
+    const/4 v2, 0x1
 
     if-nez v0, :cond_0
 
-    invoke-super {p0, v1}, Lcom/android/keyguard/KeyguardUpdateMonitor;->isUnlockingWithBiometricAllowed(Z)Z
+    invoke-super {p0, v2}, Lcom/android/keyguard/KeyguardUpdateMonitor;->isUnlockingWithBiometricAllowed(Z)Z
 
     move-result v0
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_8
 
     :cond_0
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_8
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isFingerprintOptionEnabled()Z
 
-    move-result v0
+    move-result v3
 
-    if-eqz v0, :cond_1
+    if-eqz v3, :cond_8
 
-    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mCurrentSecurityMode:Lcom/android/keyguard/KeyguardSecurityModel$SecurityMode;
+    iget-object v3, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mCurrentSecurityMode:Lcom/android/keyguard/KeyguardSecurityModel$SecurityMode;
 
-    sget-object v2, Lcom/android/keyguard/KeyguardSecurityModel$SecurityMode;->Swipe:Lcom/android/keyguard/KeyguardSecurityModel$SecurityMode;
+    sget-object v4, Lcom/android/keyguard/KeyguardSecurityModel$SecurityMode;->Swipe:Lcom/android/keyguard/KeyguardSecurityModel$SecurityMode;
 
-    if-eq v0, v2, :cond_1
+    if-eq v3, v4, :cond_8
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isFullscreenBouncer()Z
 
-    move-result v0
+    move-result v3
 
-    if-nez v0, :cond_1
+    if-nez v3, :cond_8
 
     iget-object p0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
-    invoke-static {p0}, Lcom/android/systemui/util/DeviceState;->isSmartViewDisplayWithFitToAspectRatio(Landroid/content/Context;)Z
+    sget-object v3, Lcom/android/systemui/util/DeviceState;->sDisplaySize:Landroid/graphics/Point;
+
+    if-nez v0, :cond_1
+
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isSmartViewFitToActiveDisplay()Z
 
     move-result p0
 
-    if-nez p0, :cond_1
+    goto/16 :goto_3
+
+    :cond_1
+    const-string v0, "display"
+
+    invoke-virtual {p0, v0}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+
+    move-result-object v0
+
+    check-cast v0, Landroid/hardware/display/DisplayManager;
+
+    invoke-virtual {v0}, Landroid/hardware/display/DisplayManager;->semGetWifiDisplayStatus()Landroid/hardware/display/SemWifiDisplayStatus;
+
+    move-result-object v0
+
+    if-eqz v0, :cond_2
+
+    invoke-virtual {v0}, Landroid/hardware/display/SemWifiDisplayStatus;->getActiveDisplayState()I
+
+    move-result v0
+
+    const/4 v3, 0x2
+
+    if-ne v0, v3, :cond_2
+
+    move v0, v2
 
     goto :goto_0
 
-    :cond_1
-    const/4 v1, 0x0
+    :cond_2
+    move v0, v1
 
     :goto_0
+    const-string v3, "media_router"
+
+    invoke-virtual {p0, v3}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+
+    move-result-object v3
+
+    check-cast v3, Landroid/media/MediaRouter;
+
+    const/4 v4, 0x4
+
+    invoke-virtual {v3, v4}, Landroid/media/MediaRouter;->getSelectedRoute(I)Landroid/media/MediaRouter$RouteInfo;
+
+    move-result-object v3
+
+    invoke-virtual {v3}, Landroid/media/MediaRouter$RouteInfo;->getSupportedTypes()I
+
+    move-result v5
+
+    and-int/2addr v4, v5
+
+    if-eqz v4, :cond_4
+
+    invoke-virtual {v3}, Landroid/media/MediaRouter$RouteInfo;->semGetDeviceAddress()Ljava/lang/String;
+
+    move-result-object v4
+
+    if-nez v4, :cond_4
+
+    invoke-virtual {v3}, Landroid/media/MediaRouter$RouteInfo;->semGetStatusCode()I
+
+    move-result v4
+
+    const/4 v5, 0x6
+
+    if-ne v4, v5, :cond_4
+
+    invoke-virtual {v3}, Landroid/media/MediaRouter$RouteInfo;->getPresentationDisplay()Landroid/view/Display;
+
+    move-result-object v4
+
+    if-nez v4, :cond_3
+
+    invoke-virtual {v3}, Landroid/media/MediaRouter$RouteInfo;->getDescription()Ljava/lang/CharSequence;
+
+    move-result-object v4
+
+    if-eqz v4, :cond_4
+
+    invoke-virtual {v3}, Landroid/media/MediaRouter$RouteInfo;->getDescription()Ljava/lang/CharSequence;
+
+    move-result-object v3
+
+    invoke-interface {v3}, Ljava/lang/CharSequence;->toString()Ljava/lang/String;
+
+    move-result-object v3
+
+    const-string v4, "Audio"
+
+    invoke-virtual {v3, v4}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z
+
+    move-result v3
+
+    if-eqz v3, :cond_4
+
+    :cond_3
+    move v3, v2
+
+    goto :goto_1
+
+    :cond_4
+    move v3, v1
+
+    :goto_1
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object p0
+
+    const-string v4, "lelink_cast_on"
+
+    invoke-static {p0, v4, v1}, Landroid/provider/Settings$Global;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;I)I
+
+    move-result p0
+
+    if-ne p0, v2, :cond_5
+
+    move p0, v2
+
+    goto :goto_2
+
+    :cond_5
+    move p0, v1
+
+    :goto_2
+    if-nez v0, :cond_6
+
+    if-nez v3, :cond_6
+
+    if-eqz p0, :cond_7
+
+    :cond_6
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isSmartViewFitToActiveDisplay()Z
+
+    move-result p0
+
+    if-eqz p0, :cond_7
+
+    move p0, v2
+
+    goto :goto_3
+
+    :cond_7
+    move p0, v1
+
+    :goto_3
+    if-nez p0, :cond_8
+
+    move v1, v2
+
+    :cond_8
     return v1
 .end method
 
@@ -11867,6 +12098,37 @@
     return-void
 .end method
 
+.method public final removeMaskViewForOpticalFpSensor()V
+    .locals 2
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-eqz v0, :cond_0
+
+    const-string v0, "KeyguardFingerprint"
+
+    const-string/jumbo v1, "semRemoveMaskView()"
+
+    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    iget-object v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    invoke-virtual {v0, v1}, Landroid/hardware/fingerprint/FingerprintManager;->semRemoveMaskView(Landroid/os/IBinder;)I
+
+    const/4 v0, 0x0
+
+    iput-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    :cond_0
+    return-void
+.end method
+
 .method public final reportFailedBiometricUnlockAttempt(I)V
     .locals 10
 
@@ -12016,7 +12278,7 @@
 
     move-result v0
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_2
 
     new-instance v0, Ljava/lang/StringBuilder;
 
@@ -12042,18 +12304,23 @@
 
     move-result v0
 
+    if-eqz v0, :cond_1
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     if-eqz v0, :cond_0
 
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_0
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
     goto :goto_0
 
-    :cond_0
+    :cond_1
     iget-object v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintCancelSignal:Landroid/os/CancellationSignal;
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_2
 
     invoke-virtual {v0}, Landroid/os/CancellationSignal;->cancel()V
 
@@ -12061,7 +12328,7 @@
 
     iput-object v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintCancelSignal:Landroid/os/CancellationSignal;
 
-    :cond_1
+    :cond_2
     :goto_0
     const-class v0, Lcom/android/systemui/UiOffloadThread;
 
@@ -13368,7 +13635,7 @@
 
     iput-boolean p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mKeyguardUnlocking:Z
 
-    if-eqz p1, :cond_1
+    if-eqz p1, :cond_2
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
@@ -13376,8 +13643,13 @@
 
     invoke-virtual {p0, p1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFace(Lcom/android/keyguard/FaceAuthUiEvent;)V
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz p1, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_1
     new-instance p1, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda6;
 
     const/4 v0, 0x0
@@ -13388,7 +13660,7 @@
 
     invoke-virtual {p0, v0, p1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->dispatchCallback(Ljava/lang/String;Ljava/util/function/Consumer;)V
 
-    :cond_1
+    :cond_2
     return-void
 .end method
 
@@ -16495,9 +16767,9 @@
 
     invoke-static {v5, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    if-eqz v2, :cond_4
+    if-eqz v2, :cond_5
 
-    if-nez v1, :cond_4
+    if-nez v1, :cond_5
 
     if-nez p1, :cond_3
 
@@ -16506,72 +16778,124 @@
     :cond_3
     iget p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
-    if-ne p1, v3, :cond_7
+    if-ne p1, v3, :cond_9
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
+    if-eqz p1, :cond_4
+
+    iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-nez p1, :cond_4
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_4
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
     goto :goto_2
 
-    :cond_4
-    if-nez v2, :cond_6
+    :cond_5
+    if-nez v2, :cond_8
 
-    if-eqz v1, :cond_6
+    if-eqz v1, :cond_8
 
-    if-ne p1, v3, :cond_5
+    if-ne p1, v3, :cond_6
 
     return-void
 
-    :cond_5
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    :cond_6
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz p1, :cond_7
 
+    iget-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
+
+    invoke-virtual {p1}, Lcom/android/systemui/util/SettingsHelper;->isOneHandModeRunning()Z
+
+    move-result p1
+
+    if-nez p1, :cond_7
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_7
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->startListeningForFingerprint()V
 
     goto :goto_2
 
-    :cond_6
-    if-nez v2, :cond_7
+    :cond_8
+    if-nez v2, :cond_9
 
-    if-nez v1, :cond_7
+    if-nez v1, :cond_9
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    :cond_7
+    if-eqz p1, :cond_9
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isFingerprintOptionEnabled()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_9
+
+    sget-boolean p1, Lcom/android/systemui/LsRune;->COVER_SUPPORTED:Z
+
+    if-eqz p1, :cond_9
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isCoverClosed()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_9
+
+    iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-eqz p1, :cond_9
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_9
     :goto_2
     sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz p1, :cond_a
+    if-eqz p1, :cond_c
 
-    if-nez v1, :cond_8
+    if-nez v1, :cond_a
 
-    goto :goto_3
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    :cond_8
+    if-eqz p1, :cond_c
+
+    iget-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-eqz p1, :cond_c
+
+    :cond_a
     iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mDeviceInteractive:Z
 
-    if-eqz p1, :cond_9
+    if-eqz p1, :cond_b
 
     iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mGoingToSleep:Z
 
-    if-nez p1, :cond_9
+    if-nez p1, :cond_b
 
     iget-boolean p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mIsDreamingForBiometrics:Z
 
-    if-nez p1, :cond_9
+    if-nez p1, :cond_b
 
     move v0, v3
 
-    :cond_9
+    :cond_b
     xor-int/lit8 p1, v0, 0x1
 
     iget v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpInDisplayState:I
 
-    if-eq v0, p1, :cond_a
+    if-eq v0, p1, :cond_c
 
     iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
 
-    if-eqz v0, :cond_a
+    if-eqz v0, :cond_c
 
     new-instance v0, Ljava/lang/StringBuilder;
 
@@ -16591,8 +16915,7 @@
 
     invoke-virtual {p0, p1}, Landroid/hardware/fingerprint/FingerprintManager;->semSetScreenStatus(I)I
 
-    :cond_a
-    :goto_3
+    :cond_c
     return-void
 .end method
 
diff --git a/smali/com/android/systemui/LsRune.smali b/smali/com/android/systemui/LsRune.smali
index 0f2dbf82..74334640 100644
--- a/smali/com/android/systemui/LsRune.smali
+++ b/smali/com/android/systemui/LsRune.smali
@@ -122,6 +122,8 @@
 
 .field public static final SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
+.field public static final SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
 .field public static final SECURITY_HAPTIC_FEEDBACK_ON_DC_MOTOR:Z
 
 .field public static final SECURITY_HIDE_EMERGENCY_BUTTON_BY_SIMSTATE:Z
@@ -365,7 +367,7 @@
     :goto_0
     sput-boolean v8, Lcom/android/systemui/LsRune;->KEYGUARD_DELAY_NOTIFY_DRAWN_PREMIUM_WATCH:Z
 
-    const-string v8, "2"
+    const-string v8, "1"
 
     invoke-static {v8}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
 
@@ -752,6 +754,8 @@
 
     sput-boolean v3, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
+    sput-boolean v3, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     const/4 v3, 0x0
 
     sput-boolean v3, Lcom/android/systemui/LsRune;->SECURITY_BACKGROUND_AUTHENTICATION:Z
diff --git a/smali/com/android/systemui/facewidget/plugin/PluginFaceWidgetManager.smali b/smali/com/android/systemui/facewidget/plugin/PluginFaceWidgetManager.smali
index 2fea211c..25aa91ab 100644
--- a/smali/com/android/systemui/facewidget/plugin/PluginFaceWidgetManager.smali
+++ b/smali/com/android/systemui/facewidget/plugin/PluginFaceWidgetManager.smali
@@ -537,7 +537,11 @@
 
     if-eqz p0, :cond_0
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result p0
+
+    if-eqz p0, :cond_0
 
     const/4 p0, 0x1
 
diff --git a/smali/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali b/smali/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
index f2f37bb8..c17ae023 100644
--- a/smali/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
+++ b/smali/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
@@ -44,7 +44,7 @@
 
     sget-boolean v0, Lcom/android/systemui/BasicRune;->GLOBALACTIONS_BLUR:Z
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_0
     const-string v0, "CAPTURED_BLUR"
@@ -57,7 +57,7 @@
 
     sget-boolean v0, Lcom/android/systemui/BasicRune;->GLOBALACTIONS_CAPTURED_BLUR:Z
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_1
     const-string v0, "NAV_BAR"
@@ -80,7 +80,7 @@
 
     move-result v0
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_2
     const-string v0, "SAFETY_CARE"
@@ -101,7 +101,7 @@
 
     move-result v0
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_3
     const-string v0, "SCOVER"
@@ -116,7 +116,7 @@
 
     move-result v0
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_4
     const-string v0, "DATA_MODE"
@@ -137,7 +137,7 @@
 
     move-result v0
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_5
     const-string v0, "DEMO_MODE"
@@ -258,7 +258,7 @@
 
     move-result v0
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_b
     const-string v0, "FINGERPRINT_IN_DISPLAY"
@@ -271,7 +271,13 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    goto/16 :goto_4
+    if-nez v0, :cond_15
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_16
+
+    goto/16 :goto_3
 
     :cond_c
     const-string v0, "SUPPORT_SIDE_KEY"
@@ -292,7 +298,7 @@
 
     move-result v0
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_d
     const-string v0, "POWER_OFF_LOCK"
@@ -313,7 +319,7 @@
 
     move-result v0
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_e
     const-string v0, "FRONT_LARGE_COVER_DISPLAY"
@@ -332,7 +338,7 @@
 
     move-result v0
 
-    goto/16 :goto_4
+    goto/16 :goto_5
 
     :cond_f
     const-string v0, "FRONT_COVER_DISPLAY"
@@ -372,7 +378,7 @@
 
     if-eqz v0, :cond_11
 
-    goto :goto_3
+    goto :goto_4
 
     :cond_11
     const-string v0, "KNOX_SDK"
@@ -448,12 +454,13 @@
     :goto_3
     move v0, v1
 
-    goto :goto_4
+    goto :goto_5
 
     :cond_16
+    :goto_4
     move v0, v2
 
-    :goto_4
+    :goto_5
     iget-object p0, p0, Lcom/android/systemui/globalactions/presentation/features/GlobalActionFeatures;->mLogWrapper:Lcom/samsung/android/globalactions/util/LogWrapper;
 
     new-instance v1, Ljava/lang/StringBuilder;
diff --git a/smali/com/android/systemui/keyguard/KeyguardViewMediator$$ExternalSyntheticLambda3.smali b/smali/com/android/systemui/keyguard/KeyguardViewMediator$$ExternalSyntheticLambda3.smali
index 6b11bfb0..7ec89e17 100644
--- a/smali/com/android/systemui/keyguard/KeyguardViewMediator$$ExternalSyntheticLambda3.smali
+++ b/smali/com/android/systemui/keyguard/KeyguardViewMediator$$ExternalSyntheticLambda3.smali
@@ -277,10 +277,17 @@
 
     move-result v0
 
+    if-eqz v0, :cond_9
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     if-eqz v0, :cond_8
 
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
+    invoke-interface {v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_8
     invoke-virtual {p0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->removeShowMsg()V
 
     iget-object p0, p0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewControllerLazy:Ldagger/Lazy;
@@ -295,7 +302,7 @@
 
     goto :goto_5
 
-    :cond_8
+    :cond_9
     move v1, v2
 
     :goto_5
@@ -308,7 +315,7 @@
 
     move-result v0
 
-    if-eqz v0, :cond_a
+    if-eqz v0, :cond_b
 
     iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->activityManager:Landroid/app/ActivityManager;
 
@@ -316,30 +323,30 @@
 
     move-result v0
 
-    if-eqz v0, :cond_9
+    if-eqz v0, :cond_a
 
     move v0, v1
 
     goto :goto_6
 
-    :cond_9
+    :cond_a
     move v0, v2
 
     :goto_6
-    if-eqz v0, :cond_b
+    if-eqz v0, :cond_c
 
-    :cond_a
+    :cond_b
     iget-object p0, p0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
     invoke-interface {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->isForcedLock()Z
 
     move-result p0
 
-    if-nez p0, :cond_b
+    if-nez p0, :cond_c
 
     goto :goto_7
 
-    :cond_b
+    :cond_c
     move v1, v2
 
     :goto_7
@@ -362,15 +369,15 @@
 
     iget v4, v3, Lcom/android/systemui/keyguard/KeyguardVisibilityMonitor;->curVisibility:I
 
-    if-nez v4, :cond_c
+    if-nez v4, :cond_d
 
     goto :goto_9
 
-    :cond_c
+    :cond_d
     move v1, v2
 
     :goto_9
-    if-eqz v1, :cond_d
+    if-eqz v1, :cond_e
 
     iget-object v0, v0, Lcom/android/keyguard/KeyguardDisplayManager;->mVisibilityListener:Lcom/android/keyguard/KeyguardDisplayManager$$ExternalSyntheticLambda0;
 
@@ -378,13 +385,13 @@
 
     goto :goto_a
 
-    :cond_d
+    :cond_e
     invoke-virtual {v0}, Lcom/android/keyguard/KeyguardDisplayManager;->hide()V
 
     :goto_a
     iget-boolean v0, p0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isAODShowStateCbRegistered:Z
 
-    if-eqz v0, :cond_e
+    if-eqz v0, :cond_f
 
     iget-object v0, p0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->aodShowStateCallback:Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl$aodShowStateCallback$1;
 
@@ -392,7 +399,7 @@
 
     invoke-virtual {v1, v0}, Lcom/android/systemui/util/SettingsHelper;->unregisterCallback(Lcom/android/systemui/util/SettingsHelper$OnChangedCallback;)V
 
-    :cond_e
+    :cond_f
     iput-boolean v2, p0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isAODShowStateCbRegistered:Z
 
     new-instance v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl$registerSysDumpHeap$1;
@@ -405,8 +412,6 @@
 
     return v2
 
-    nop
-
     :pswitch_data_0
     .packed-switch 0x0
         :pswitch_4
diff --git a/smali/com/android/systemui/keyguard/KeyguardViewMediator$$ExternalSyntheticLambda6.smali b/smali/com/android/systemui/keyguard/KeyguardViewMediator$$ExternalSyntheticLambda6.smali
index 079ffe8f..f6589568 100644
--- a/smali/com/android/systemui/keyguard/KeyguardViewMediator$$ExternalSyntheticLambda6.smali
+++ b/smali/com/android/systemui/keyguard/KeyguardViewMediator$$ExternalSyntheticLambda6.smali
@@ -68,7 +68,7 @@
 
     packed-switch v2, :pswitch_data_0
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :pswitch_0
     sget-boolean v2, Lcom/android/systemui/LsRune;->SUPPORT_LARGE_FRONT_SUB_DISPLAY:Z
@@ -188,7 +188,7 @@
 
     invoke-static {v3, v0}, Landroid/util/Log;->w(Ljava/lang/String;Ljava/lang/String;)I
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_3
     check-cast v2, Ljava/util/ArrayList;
@@ -259,23 +259,23 @@
 
     invoke-virtual {v0}, Lcom/android/systemui/subscreen/SubScreenManager;->startSubHomeActivity()V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :pswitch_1
     iget-object v0, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->desktopManager:Lcom/android/systemui/util/DesktopManager;
 
     iget v1, v1, Landroid/os/Message;->arg1:I
 
-    if-eqz v1, :cond_6
+    if-eqz v1, :cond_mesa
 
     move v5, v6
 
-    :cond_6
+    :cond_mesa
     check-cast v0, Lcom/android/systemui/util/DesktopManagerImpl;
 
     invoke-virtual {v0, v5}, Lcom/android/systemui/util/DesktopManagerImpl;->notifyOccluded(Z)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :pswitch_2
     iget-object v1, v1, Landroid/os/Message;->obj:Ljava/lang/Object;
@@ -310,7 +310,7 @@
 
     const-string v10, "KeyguardViewMediator"
 
-    if-eqz v8, :cond_18
+    if-eqz v8, :cond_19
 
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isFastWakeAndUnlockMode()Z
 
@@ -318,15 +318,15 @@
 
     iget-object v11, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
-    if-eqz v8, :cond_a
+    if-eqz v8, :cond_9
 
     iget-boolean v8, v11, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->needsBlankScreen:Z
 
-    if-eqz v8, :cond_7
+    if-eqz v8, :cond_6
 
     goto :goto_5
 
-    :cond_7
+    :cond_6
     invoke-virtual {v11}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->getMode()I
 
     move-result v8
@@ -335,118 +335,118 @@
 
     move-result v12
 
-    if-eqz v12, :cond_8
+    if-eqz v12, :cond_7
 
     sget v12, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_FRAME_COMMIT:I
 
     and-int/2addr v8, v12
 
-    if-ne v8, v12, :cond_8
+    if-ne v8, v12, :cond_7
 
     move v8, v6
 
     goto :goto_4
 
-    :cond_8
+    :cond_7
     move v8, v5
 
     :goto_4
-    if-nez v8, :cond_9
+    if-nez v8, :cond_8
 
     move v8, v6
 
-    goto/16 :goto_a
+    goto/16 :goto_b
 
-    :cond_9
+    :cond_8
     :goto_5
     move v12, v5
 
     move v8, v6
 
-    goto/16 :goto_b
+    goto/16 :goto_c
 
-    :cond_a
+    :cond_9
     invoke-virtual {v11}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isFastUnlockMode()Z
 
     move-result v8
 
-    if-eqz v8, :cond_12
+    if-eqz v8, :cond_13
 
     invoke-virtual {v9}, Lcom/android/systemui/util/SettingsHelper;->isEnabledFaceStayOnLock()Z
 
     move-result v8
 
-    if-nez v8, :cond_c
+    if-nez v8, :cond_b
 
     invoke-virtual {v11}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isEnabled()Z
 
     move-result v8
 
-    if-eqz v8, :cond_b
+    if-eqz v8, :cond_a
 
     iget-object v8, v11, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->biometricSourceType:Landroid/hardware/biometrics/BiometricSourceType;
 
     sget-object v12, Landroid/hardware/biometrics/BiometricSourceType;->FACE:Landroid/hardware/biometrics/BiometricSourceType;
 
-    if-ne v8, v12, :cond_b
+    if-ne v8, v12, :cond_a
 
     move v8, v6
 
     goto :goto_6
 
-    :cond_b
+    :cond_a
     move v8, v5
 
     :goto_6
-    if-nez v8, :cond_e
+    if-nez v8, :cond_d
 
-    :cond_c
+    :cond_b
     invoke-virtual {v11}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isEnabled()Z
 
     move-result v8
 
-    if-eqz v8, :cond_d
+    if-eqz v8, :cond_c
 
     iget-object v8, v11, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->biometricSourceType:Landroid/hardware/biometrics/BiometricSourceType;
 
     sget-object v12, Landroid/hardware/biometrics/BiometricSourceType;->FINGERPRINT:Landroid/hardware/biometrics/BiometricSourceType;
 
-    if-ne v8, v12, :cond_d
+    if-ne v8, v12, :cond_c
 
     move v8, v6
 
     goto :goto_7
 
-    :cond_d
+    :cond_c
     move v8, v5
 
     :goto_7
-    if-eqz v8, :cond_12
+    if-eqz v8, :cond_13
 
-    :cond_e
+    :cond_d
     iget-object v8, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fixedRotationMonitor:Lcom/android/systemui/keyguard/KeyguardFixedRotationMonitor;
 
     iget-boolean v12, v8, Lcom/android/systemui/keyguard/KeyguardFixedRotationMonitor;->isMonitorStarted:Z
 
-    if-eqz v12, :cond_f
+    if-eqz v12, :cond_e
 
     iget-boolean v12, v8, Lcom/android/systemui/keyguard/KeyguardFixedRotationMonitor;->isFixedRotated:Z
 
-    if-eqz v12, :cond_f
+    if-eqz v12, :cond_e
 
     move v12, v6
 
     goto :goto_8
 
-    :cond_f
+    :cond_e
     move v12, v5
 
     :goto_8
-    if-eqz v12, :cond_10
+    if-eqz v12, :cond_f
 
     iget-object v12, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v12, :cond_10
+    if-eqz v12, :cond_f
 
     new-instance v13, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl$showForegroundImmediatelyIfNeeded$1;
 
@@ -462,56 +462,85 @@
 
     goto :goto_9
 
-    :cond_10
+    :cond_f
     move v8, v6
 
     :goto_9
-    sget-object v12, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean v12, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    iget-object v12, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
+    if-eqz v12, :cond_11
 
+    invoke-virtual {v11}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isEnabled()Z
+
+    move-result v12
+
+    if-eqz v12, :cond_10
+
+    iget-object v12, v11, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->biometricSourceType:Landroid/hardware/biometrics/BiometricSourceType;
+
+    sget-object v13, Landroid/hardware/biometrics/BiometricSourceType;->FINGERPRINT:Landroid/hardware/biometrics/BiometricSourceType;
+
+    if-ne v12, v13, :cond_10
+
+    move v12, v6
+
+    goto :goto_a
+
+    :cond_10
+    move v12, v5
+
+    :goto_a
     if-eqz v12, :cond_11
 
+    iget-object v12, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
+
+    invoke-interface {v12}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_11
+    iget-object v12, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
+
+    if-eqz v12, :cond_12
+
     array-length v13, v12
 
-    if-lez v13, :cond_11
+    if-lez v13, :cond_12
 
     aget-object v12, v12, v5
 
-    if-eqz v12, :cond_11
+    if-eqz v12, :cond_12
 
     iget-object v12, v11, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->curVisibilityController:Lcom/android/systemui/keyguard/VisibilityController;
 
-    if-eqz v12, :cond_11
+    if-eqz v12, :cond_12
 
     invoke-interface {v12}, Lcom/android/systemui/keyguard/VisibilityController;->setLeash()V
 
-    :cond_11
+    :cond_12
     invoke-virtual {v11, v6}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->setForceInvisible(Z)V
 
     move v12, v6
 
-    goto :goto_b
+    goto :goto_c
 
-    :cond_12
+    :cond_13
     move v8, v5
 
-    :goto_a
+    :goto_b
     move v12, v8
 
-    :goto_b
-    if-eqz v8, :cond_14
+    :goto_c
+    if-eqz v8, :cond_15
 
     iget-object v8, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v8, :cond_13
+    if-eqz v8, :cond_14
 
     :try_start_0
     invoke-interface {v8}, Landroid/view/IRemoteAnimationFinishedCallback;->onAnimationFinished()V
     :try_end_0
     .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
 
-    goto :goto_c
+    goto :goto_d
 
     :catch_0
     const-string v8, "RemoteException"
@@ -524,21 +553,21 @@
 
     invoke-static {v13, v14, v8, v4}, Lcom/android/systemui/keyguard/KeyguardDumpLog;->log(Ljava/lang/String;Lcom/android/systemui/log/LogLevel;Ljava/lang/String;Ljava/lang/Throwable;)V
 
-    :goto_c
+    :goto_d
     iput-object v4, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    :cond_13
+    :cond_14
     iput-object v4, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    :cond_14
-    if-eqz v12, :cond_15
+    :cond_15
+    if-eqz v12, :cond_16
 
     const-string/jumbo v8, "showForegroundImmediatelyIfNeeded returns true"
 
     invoke-static {v8}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->logD(Ljava/lang/String;)V
 
-    :cond_15
-    if-eqz v12, :cond_18
+    :cond_16
+    if-eqz v12, :cond_19
 
     new-instance v1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl$handleOverrideStartKeyguardExitAnimation$1;
 
@@ -546,7 +575,7 @@
 
     iget-object v0, v11, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->delayedActionParams:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;
 
-    if-eqz v0, :cond_17
+    if-eqz v0, :cond_18
 
     iget-object v2, v0, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;->handler:Landroid/os/Handler;
 
@@ -556,14 +585,14 @@
 
     move-result v4
 
-    if-eqz v4, :cond_16
+    if-eqz v4, :cond_17
 
     invoke-virtual {v2, v3}, Landroid/os/Handler;->removeCallbacks(Ljava/lang/Runnable;)V
 
-    :cond_16
+    :cond_17
     iput-boolean v6, v0, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;->isDiscard:Z
 
-    :cond_17
+    :cond_18
     new-instance v0, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;
 
     iget-object v2, v11, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->mainHandler:Landroid/os/Handler;
@@ -576,9 +605,9 @@
 
     iput-object v0, v11, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->delayedActionParams:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
-    :cond_18
+    :cond_19
     iget-object v8, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorLazy:Ldagger/Lazy;
 
     invoke-interface {v8}, Ldagger/Lazy;->get()Ljava/lang/Object;
@@ -591,11 +620,11 @@
 
     move-result v8
 
-    if-eqz v8, :cond_19
+    if-eqz v8, :cond_1a
 
-    goto/16 :goto_15
+    goto/16 :goto_16
 
-    :cond_19
+    :cond_1a
     iget-object v8, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->scrimControllerLazy:Ldagger/Lazy;
 
     invoke-interface {v8}, Ldagger/Lazy;->get()Ljava/lang/Object;
@@ -610,78 +639,78 @@
 
     iget-object v12, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->sysuiStatusBarStateController:Lcom/android/systemui/statusbar/SysuiStatusBarStateController;
 
-    if-eq v8, v11, :cond_1a
+    if-eq v8, v11, :cond_1b
 
     move v7, v6
 
-    goto :goto_f
+    goto :goto_10
 
-    :cond_1a
+    :cond_1b
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isLaunchTransition()Z
 
     move-result v8
 
-    if-eqz v8, :cond_1b
+    if-eqz v8, :cond_1c
 
     move v7, v3
 
-    goto :goto_f
+    goto :goto_10
 
-    :cond_1b
+    :cond_1c
     move-object v8, v12
 
     check-cast v8, Lcom/android/systemui/statusbar/StatusBarStateControllerImpl;
 
     iget-boolean v8, v8, Lcom/android/systemui/statusbar/StatusBarStateControllerImpl;->mLeaveOpenOnKeyguardHide:Z
 
-    if-eqz v8, :cond_1c
+    if-eqz v8, :cond_1d
 
-    goto :goto_f
+    goto :goto_10
 
-    :cond_1c
+    :cond_1d
     iget-object v7, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v7, :cond_1d
+    if-eqz v7, :cond_1e
 
     array-length v7, v7
 
-    if-le v7, v6, :cond_1d
+    if-le v7, v6, :cond_1e
 
     const/4 v7, 0x4
 
-    goto :goto_f
+    goto :goto_10
 
-    :cond_1d
+    :cond_1e
     iget-boolean v7, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->disableRemoteUnlockAnimation:Z
 
-    if-eqz v7, :cond_1e
+    if-eqz v7, :cond_1f
 
     const/4 v7, 0x5
 
-    goto :goto_f
+    goto :goto_10
 
-    :cond_1e
+    :cond_1f
     iget v7, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->lastGoingAwayFlags:I
 
     and-int/2addr v7, v3
 
-    if-ne v7, v3, :cond_1f
+    if-ne v7, v3, :cond_20
 
     move v7, v6
 
-    goto :goto_d
+    goto :goto_e
 
-    :cond_1f
+    :cond_20
     move v7, v5
 
-    :goto_d
-    if-eqz v7, :cond_20
+    :goto_e
+    if-eqz v7, :cond_21
 
     const/4 v7, 0x6
 
-    goto :goto_f
+    goto :goto_10
 
-    :cond_20
+    :cond_21
     invoke-virtual {v9}, Lcom/android/systemui/util/SettingsHelper;->getTransitionAnimationScale()F
 
     move-result v7
@@ -690,23 +719,23 @@
 
     cmpg-float v7, v7, v8
 
-    if-nez v7, :cond_21
+    if-nez v7, :cond_22
 
     move v7, v6
 
-    goto :goto_e
+    goto :goto_f
 
-    :cond_21
+    :cond_22
     move v7, v5
 
-    :goto_e
-    if-eqz v7, :cond_22
+    :goto_f
+    if-eqz v7, :cond_23
 
     const/4 v7, 0x7
 
-    goto :goto_f
+    goto :goto_10
 
-    :cond_22
+    :cond_23
     iget-object v7, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->desktopManager:Lcom/android/systemui/util/DesktopManager;
 
     check-cast v7, Lcom/android/systemui/util/DesktopManagerImpl;
@@ -715,25 +744,25 @@
 
     move-result v7
 
-    if-eqz v7, :cond_23
+    if-eqz v7, :cond_mesa2
 
     const/16 v7, 0x8
 
-    goto :goto_f
+    goto :goto_10
 
-    :cond_23
+    :cond_mesa2
     sget-boolean v7, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImplKt;->DEBUG_DISABLE_REMOTE_UNLOCK_ANIMATION:Z
 
     if-eqz v7, :cond_24
 
     const/16 v7, 0xff
 
-    goto :goto_f
+    goto :goto_10
 
     :cond_24
     move v7, v5
 
-    :goto_f
+    :goto_10
     if-eqz v7, :cond_25
 
     new-instance v8, Ljava/lang/StringBuilder;
@@ -752,12 +781,12 @@
 
     move v7, v6
 
-    goto :goto_10
+    goto :goto_11
 
     :cond_25
     move v7, v5
 
-    :goto_10
+    :goto_11
     if-eqz v7, :cond_2c
 
     iget-object v7, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
@@ -770,12 +799,12 @@
 
     move v7, v6
 
-    goto :goto_11
+    goto :goto_12
 
     :cond_26
     move v7, v5
 
-    :goto_11
+    :goto_12
     xor-int/2addr v6, v7
 
     if-eqz v6, :cond_2a
@@ -809,7 +838,7 @@
 
     move v9, v5
 
-    :goto_12
+    :goto_13
     if-ge v9, v8, :cond_2a
 
     aget-object v11, v6, v9
@@ -836,7 +865,7 @@
 
     if-nez v14, :cond_28
 
-    goto :goto_13
+    goto :goto_14
 
     :cond_28
     new-instance v14, Landroid/view/SyncRtSurfaceTransactionApplier$SurfaceParams$Builder;
@@ -866,10 +895,10 @@
     invoke-virtual {v12, v11}, Landroid/view/SyncRtSurfaceTransactionApplier;->scheduleApply([Landroid/view/SyncRtSurfaceTransactionApplier$SurfaceParams;)V
 
     :cond_29
-    :goto_13
+    :goto_14
     add-int/lit8 v9, v9, 0x1
 
-    goto :goto_12
+    goto :goto_13
 
     :cond_2a
     iput-object v4, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
@@ -891,7 +920,7 @@
     :catch_1
     iput-object v4, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    goto :goto_15
+    goto :goto_16
 
     :cond_2c
     iget-object v4, v1, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
@@ -904,12 +933,12 @@
 
     move v7, v6
 
-    goto :goto_14
+    goto :goto_15
 
     :cond_2d
     move v7, v5
 
-    :goto_14
+    :goto_15
     xor-int/2addr v6, v7
 
     if-eqz v6, :cond_2f
@@ -932,7 +961,7 @@
 
     if-eqz v6, :cond_2e
 
-    goto :goto_15
+    goto :goto_16
 
     :cond_2e
     iget-object v6, v4, Landroid/view/RemoteAnimationTarget;->leash:Landroid/view/SurfaceControl;
@@ -954,7 +983,7 @@
     invoke-interface {v4, v8}, Ljava/util/concurrent/Executor;->execute(Ljava/lang/Runnable;)V
 
     :cond_2f
-    :goto_15
+    :goto_16
     invoke-static {}, Landroid/os/SystemClock;->uptimeMillis()J
 
     move-result-wide v6
@@ -998,7 +1027,7 @@
     :try_end_2
     .catch Landroid/os/RemoteException; {:try_start_2 .. :try_end_2} :catch_3
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_30
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->getHandler()Landroid/os/Handler;
@@ -1007,7 +1036,7 @@
 
     invoke-virtual {v0, v2}, Landroid/os/Handler;->handleMessage(Landroid/os/Message;)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :pswitch_3
     iget-object v0, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->foldControllerImpl:Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;
@@ -1020,24 +1049,24 @@
 
     move v2, v6
 
-    goto :goto_16
+    goto :goto_17
 
     :cond_31
     move v2, v5
 
-    :goto_16
+    :goto_17
     iget v1, v1, Landroid/os/Message;->arg2:I
 
     if-nez v1, :cond_32
 
     move v1, v6
 
-    goto :goto_17
+    goto :goto_18
 
     :cond_32
     move v1, v5
 
-    :goto_17
+    :goto_18
     iget-object v8, v0, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->dependency:Lcom/android/systemui/keyguard/KeyguardFoldControllerDependency;
 
     const-string v9, "KeyguardFoldController"
@@ -1114,7 +1143,7 @@
 
     invoke-virtual {v8, v4, v4}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->dismiss(Lcom/android/internal/policy/IKeyguardDismissCallback;Ljava/lang/CharSequence;)V
 
-    goto/16 :goto_1a
+    goto/16 :goto_1b
 
     :cond_33
     invoke-virtual {v8}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->isShowingAndNotOccluded()Z
@@ -1153,7 +1182,7 @@
 
     invoke-static {v4, v5}, Lcom/android/systemui/keyguard/Log;->d(Ljava/lang/String;Ljava/lang/String;)V
 
-    goto/16 :goto_1a
+    goto/16 :goto_1b
 
     :cond_34
     iget-object v8, v0, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->viewMediatorHelper$delegate:Lkotlin/Lazy;
@@ -1187,12 +1216,12 @@
 
     move v8, v6
 
-    goto :goto_18
+    goto :goto_19
 
     :cond_35
     move v8, v5
 
-    :goto_18
+    :goto_19
     monitor-exit v9
 
     if-eqz v8, :cond_36
@@ -1209,7 +1238,7 @@
 
     invoke-static {v4, v5}, Lcom/android/systemui/keyguard/Log;->d(Ljava/lang/String;Ljava/lang/String;)V
 
-    goto/16 :goto_1a
+    goto/16 :goto_1b
 
     :cond_36
     iget-object v8, v0, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->viewMediatorHelper$delegate:Lkotlin/Lazy;
@@ -1314,7 +1343,7 @@
 
     if-eqz v9, :cond_39
 
-    goto :goto_19
+    goto :goto_1a
 
     :cond_39
     invoke-virtual {v0, v6}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->setFoldOpenState(I)V
@@ -1329,10 +1358,10 @@
 
     invoke-interface {v3}, Lcom/android/keyguard/KeyguardViewController;->folderOpenAndDismiss()V
 
-    goto/16 :goto_1a
+    goto/16 :goto_1b
 
     :cond_3a
-    :goto_19
+    :goto_1a
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->getViewMediator()Lcom/android/systemui/keyguard/KeyguardViewMediator;
 
     move-result-object v4
@@ -1379,7 +1408,7 @@
 
     invoke-interface {v3}, Lkotlin/jvm/functions/Function0;->invoke()Ljava/lang/Object;
 
-    goto :goto_1a
+    goto :goto_1b
 
     :catchall_0
     move-exception v0
@@ -1403,7 +1432,7 @@
 
     invoke-virtual {v8, v4, v4}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->dismiss(Lcom/android/internal/policy/IKeyguardDismissCallback;Ljava/lang/CharSequence;)V
 
-    goto :goto_1a
+    goto :goto_1b
 
     :cond_3e
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->getViewMediator()Lcom/android/systemui/keyguard/KeyguardViewMediator;
@@ -1422,7 +1451,7 @@
 
     invoke-interface {v3}, Lcom/android/keyguard/ViewMediatorCallback;->resetKeyguard()V
 
-    goto :goto_1a
+    goto :goto_1b
 
     :cond_3f
     iget-object v3, v0, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->foldConfig:Lcom/android/systemui/keyguard/KeyguardFoldControllerConfig;
@@ -1454,7 +1483,7 @@
     invoke-interface {v3}, Lkotlin/jvm/functions/Function0;->invoke()Ljava/lang/Object;
 
     :cond_40
-    :goto_1a
+    :goto_1b
     iget-object v3, v0, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->normalRankedStateListeners:Ljava/util/List;
 
     iget-object v4, v0, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->foldConfig:Lcom/android/systemui/keyguard/KeyguardFoldControllerConfig;
@@ -1467,7 +1496,7 @@
 
     invoke-virtual {v0, v3, v2, v1, v4}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->onFoldStateChanged(Ljava/util/List;ZZZ)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :pswitch_4
     iget-object v1, v1, Landroid/os/Message;->obj:Ljava/lang/Object;
@@ -1515,12 +1544,12 @@
 
     move v2, v6
 
-    goto :goto_1b
+    goto :goto_1c
 
     :cond_42
     move v2, v5
 
-    :goto_1b
+    :goto_1c
     if-nez v2, :cond_45
 
     iget-object v2, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
@@ -1543,12 +1572,12 @@
 
     move v2, v6
 
-    goto :goto_1c
+    goto :goto_1d
 
     :cond_43
     move v2, v5
 
-    :goto_1c
+    :goto_1d
     if-nez v2, :cond_45
 
     :cond_44
@@ -1565,7 +1594,7 @@
 
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->notifyDrawn()V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_46
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->getLock()Ljava/lang/Object;
@@ -1593,12 +1622,12 @@
 
     move v7, v6
 
-    goto :goto_1d
+    goto :goto_1e
 
     :cond_47
     move v7, v5
 
-    :goto_1d
+    :goto_1e
     iget-wide v8, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->lastShowingTime:J
 
     const-wide/16 v10, 0x0
@@ -1656,12 +1685,12 @@
 
     move v13, v6
 
-    goto :goto_1e
+    goto :goto_1f
 
     :cond_49
     move v13, v5
 
-    :goto_1e
+    :goto_1f
     new-instance v14, Ljava/lang/StringBuilder;
 
     invoke-direct {v14, v1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
@@ -1716,7 +1745,7 @@
 
     monitor-exit v2
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_4a
     :try_start_5
@@ -1738,7 +1767,7 @@
     :cond_4c
     iput-object v4, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->drawnCallback:Lcom/android/internal/policy/IKeyguardDrawnCallback;
 
-    goto/16 :goto_20
+    goto/16 :goto_21
 
     :cond_4d
     sget-boolean v1, Lcom/android/systemui/LsRune;->KEYGUARD_DELAY_NOTIFY_DRAWN_PREMIUM_WATCH:Z
@@ -1771,12 +1800,12 @@
 
     move v1, v6
 
-    goto :goto_1f
+    goto :goto_20
 
     :cond_4e
     move v1, v5
 
-    :goto_1f
+    :goto_20
     if-eqz v1, :cond_51
 
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->hasOccludedMsg$1()Z
@@ -1831,7 +1860,7 @@
 
     monitor-exit v2
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_51
     const-wide/16 v5, 0xc8
@@ -1861,20 +1890,20 @@
 
     monitor-exit v2
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_52
     :try_start_7
     invoke-virtual {v0, v4}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->notifyDrawn(Lcom/android/internal/policy/IKeyguardDrawnCallback;)V
 
-    :goto_20
+    :goto_21
     sget-object v0, Lkotlin/Unit;->INSTANCE:Lkotlin/Unit;
     :try_end_7
     .catchall {:try_start_7 .. :try_end_7} :catchall_1
 
     monitor-exit v2
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :catchall_1
     move-exception v0
@@ -1912,12 +1941,12 @@
 
     move-result v3
 
-    goto :goto_21
+    goto :goto_22
 
     :cond_53
     move v3, v5
 
-    :goto_21
+    :goto_22
     const-string v7, "ignoreUnlock"
 
     if-eqz v1, :cond_54
@@ -1926,12 +1955,12 @@
 
     move-result v8
 
-    goto :goto_22
+    goto :goto_23
 
     :cond_54
     move v8, v5
 
-    :goto_22
+    :goto_23
     if-eqz v1, :cond_55
 
     const-string v9, "notificationKey"
@@ -1940,12 +1969,12 @@
 
     move-result-object v9
 
-    goto :goto_23
+    goto :goto_24
 
     :cond_55
     move-object v9, v4
 
-    :goto_23
+    :goto_24
     const-string/jumbo v10, "runOnCover"
 
     if-eqz v1, :cond_56
@@ -1954,12 +1983,12 @@
 
     move-result v11
 
-    goto :goto_24
+    goto :goto_25
 
     :cond_56
     move v11, v5
 
-    :goto_24
+    :goto_25
     sget-boolean v12, Lcom/android/systemui/LsRune;->COVER_SUPPORTED:Z
 
     iget-object v13, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
@@ -2008,12 +2037,12 @@
 
     move-result v10
 
-    goto :goto_25
+    goto :goto_26
 
     :cond_5b
     move v10, v5
 
-    :goto_25
+    :goto_26
     if-eqz v1, :cond_5c
 
     const-string v11, "bio_extend_duration"
@@ -2022,12 +2051,12 @@
 
     move-result v11
 
-    goto :goto_26
+    goto :goto_27
 
     :cond_5c
     move v11, v5
 
-    :goto_26
+    :goto_27
     if-eqz v1, :cond_5d
 
     const-string/jumbo v12, "showCoverToast"
@@ -2036,30 +2065,30 @@
 
     move-result v12
 
-    goto :goto_27
+    goto :goto_28
 
     :cond_5d
     move v12, v5
 
-    :goto_27
+    :goto_28
     if-nez v12, :cond_5f
 
     if-nez v11, :cond_5f
 
     if-eqz v10, :cond_5e
 
-    goto :goto_28
+    goto :goto_29
 
     :cond_5e
     move v10, v5
 
-    goto :goto_29
+    goto :goto_2a
 
     :cond_5f
-    :goto_28
+    :goto_29
     move v10, v6
 
-    :goto_29
+    :goto_2a
     if-eqz v10, :cond_62
 
     :cond_60
@@ -2098,7 +2127,7 @@
 
     invoke-interface {v0, v2, v1}, Lcom/android/systemui/plugins/subscreen/PluginSubScreen;->requestOpenAppPopup(Landroid/app/PendingIntent;Landroid/content/Intent;)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_62
     if-eqz v8, :cond_63
@@ -2109,7 +2138,7 @@
 
     invoke-virtual {v0, v2, v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->startSetPendingIntent(Landroid/app/PendingIntent;Landroid/content/Intent;)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_63
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isShowing()Z
@@ -2138,12 +2167,12 @@
 
     move-result v7
 
-    goto :goto_2a
+    goto :goto_2b
 
     :cond_64
     move v7, v5
 
-    :goto_2a
+    :goto_2b
     iget-object v8, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->userTracker:Lcom/android/systemui/settings/UserTracker;
 
     check-cast v8, Lcom/android/systemui/settings/UserTrackerImpl;
@@ -2164,18 +2193,18 @@
 
     if-nez v8, :cond_65
 
-    goto :goto_2b
+    goto :goto_2c
 
     :cond_65
     move v10, v5
 
-    goto :goto_2c
+    goto :goto_2d
 
     :cond_66
-    :goto_2b
+    :goto_2c
     move v10, v6
 
-    :goto_2c
+    :goto_2d
     if-eqz v1, :cond_6c
 
     const-string v11, "dismissType"
@@ -2202,7 +2231,7 @@
 
     if-eq v12, v14, :cond_67
 
-    goto :goto_2e
+    goto :goto_2f
 
     :cond_67
     const-string v12, "fingerprinterror"
@@ -2213,14 +2242,14 @@
 
     if-nez v11, :cond_68
 
-    goto :goto_2e
+    goto :goto_2f
 
     :cond_68
     sget-object v10, Lcom/android/keyguard/KeyguardConstants$KeyguardDismissActionType;->KEYGUARD_DISMISS_ACTION_FINGERPRINT_ERROR:Lcom/android/keyguard/KeyguardConstants$KeyguardDismissActionType;
 
     invoke-interface {v13, v10}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->setDismissActionType(Lcom/android/keyguard/KeyguardConstants$KeyguardDismissActionType;)V
 
-    goto :goto_2d
+    goto :goto_2e
 
     :cond_69
     const-string/jumbo v12, "shutdown"
@@ -2235,7 +2264,7 @@
 
     invoke-interface {v13, v10}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->setDismissActionType(Lcom/android/keyguard/KeyguardConstants$KeyguardDismissActionType;)V
 
-    goto :goto_2d
+    goto :goto_2e
 
     :cond_6a
     const-string/jumbo v12, "reboot"
@@ -2246,18 +2275,18 @@
 
     if-nez v11, :cond_6b
 
-    goto :goto_2e
+    goto :goto_2f
 
     :cond_6b
     sget-object v10, Lcom/android/keyguard/KeyguardConstants$KeyguardDismissActionType;->KEYGUARD_DISMISS_ACTION_REBOOT:Lcom/android/keyguard/KeyguardConstants$KeyguardDismissActionType;
 
     invoke-interface {v13, v10}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->setDismissActionType(Lcom/android/keyguard/KeyguardConstants$KeyguardDismissActionType;)V
 
-    :goto_2d
+    :goto_2e
     move v10, v6
 
     :cond_6c
-    :goto_2e
+    :goto_2f
     sget-object v11, Lcom/android/systemui/keyguard/KeyguardUnlockInfo$UnlockTrigger;->TRIGGER_PENDING_INTENT:Lcom/android/systemui/keyguard/KeyguardUnlockInfo$UnlockTrigger;
 
     invoke-static {v11}, Lcom/android/systemui/keyguard/KeyguardUnlockInfo;->setUnlockTrigger(Lcom/android/systemui/keyguard/KeyguardUnlockInfo$UnlockTrigger;)V
@@ -2270,12 +2299,12 @@
 
     move-result v10
 
-    goto :goto_2f
+    goto :goto_30
 
     :cond_6d
     move v10, v5
 
-    :goto_2f
+    :goto_30
     iget-object v11, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewControllerLazy:Ldagger/Lazy;
 
     if-nez v9, :cond_6e
@@ -2301,12 +2330,12 @@
     :cond_70
     move v3, v6
 
-    goto :goto_30
+    goto :goto_31
 
     :cond_71
     move v3, v5
 
-    :goto_30
+    :goto_31
     if-eqz v1, :cond_72
 
     const-string/jumbo v8, "withAnimation"
@@ -2381,14 +2410,14 @@
 
     invoke-interface/range {v14 .. v19}, Lcom/android/keyguard/KeyguardViewController;->dismissWithAction(Lcom/android/systemui/plugins/ActivityStarter$OnDismissAction;Ljava/lang/Runnable;ZZZ)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_74
     if-eqz v3, :cond_75
 
     invoke-virtual {v0, v2, v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->startSetPendingIntent(Landroid/app/PendingIntent;Landroid/content/Intent;)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_75
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->getViewMediatorProvider()Lcom/android/systemui/keyguard/ViewMediatorProvider;
@@ -2413,7 +2442,7 @@
 
     invoke-virtual {v0, v2, v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->startSetPendingIntent(Landroid/app/PendingIntent;Landroid/content/Intent;)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_76
     const-string v1, "adjustStatusBarLocked - ADJUST_STATUS_BAR : flags=0x"
@@ -2470,7 +2499,7 @@
     :try_end_8
     .catch Landroid/os/RemoteException; {:try_start_8 .. :try_end_8} :catch_2
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :catch_2
     move-exception v0
@@ -2479,7 +2508,7 @@
 
     invoke-static {v1, v0}, Lcom/android/systemui/keyguard/Slog;->w(Ljava/lang/String;Ljava/lang/Throwable;)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_78
     const-string v1, "handleBootCompleted"
@@ -2532,7 +2561,7 @@
 
     move v7, v5
 
-    :goto_31
+    :goto_32
     if-ge v7, v3, :cond_7c
 
     aget-object v8, v2, v7
@@ -2543,7 +2572,7 @@
 
     invoke-static {v1, v9}, Landroid/util/Log;->i(Ljava/lang/String;Ljava/lang/String;)I
 
-    goto :goto_32
+    goto :goto_33
 
     :cond_79
     invoke-virtual {v8}, Landroid/view/Display;->getDisplayId()I
@@ -2568,7 +2597,7 @@
 
     move v9, v6
 
-    goto :goto_33
+    goto :goto_34
 
     :cond_7a
     new-instance v9, Ljava/lang/StringBuilder;
@@ -2585,23 +2614,23 @@
 
     invoke-static {v1, v9}, Landroid/util/Log;->i(Ljava/lang/String;Ljava/lang/String;)I
 
-    :goto_32
+    :goto_33
     move v9, v5
 
-    :goto_33
+    :goto_34
     if-eqz v9, :cond_7b
 
     move-object v4, v8
 
-    goto :goto_34
+    goto :goto_35
 
     :cond_7b
     add-int/lit8 v7, v7, 0x1
 
-    goto :goto_31
+    goto :goto_32
 
     :cond_7c
-    :goto_34
+    :goto_35
     iput-object v4, v0, Lcom/android/systemui/subscreen/SubScreenManager;->mSubDisplay:Landroid/view/Display;
 
     invoke-virtual {v0}, Lcom/android/systemui/subscreen/SubScreenManager;->initWindow()V
@@ -2622,7 +2651,7 @@
 
     invoke-virtual {v0, v1}, Lcom/android/systemui/statusbar/notification/collection/NotifPipeline;->addCollectionListener(Lcom/android/systemui/statusbar/notification/collection/notifcollection/NotifCollectionListener;)V
 
-    goto/16 :goto_37
+    goto/16 :goto_38
 
     :cond_7d
     const-string v1, "handleLaunchPersoLock"
@@ -2668,7 +2697,7 @@
 
     invoke-virtual {v0, v4}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->doKeyguardLocked(Landroid/os/Bundle;)V
 
-    goto :goto_35
+    goto :goto_36
 
     :cond_7e
     iget-object v2, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->KEYGUARD_DONE$delegate:Lkotlin/Lazy;
@@ -2726,14 +2755,14 @@
     :cond_7f
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked()V
 
-    :goto_35
+    :goto_36
     sget-object v0, Lkotlin/Unit;->INSTANCE:Lkotlin/Unit;
     :try_end_9
     .catchall {:try_start_9 .. :try_end_9} :catchall_2
 
     monitor-exit v1
 
-    goto :goto_37
+    goto :goto_38
 
     :catchall_2
     move-exception v0
@@ -2785,7 +2814,7 @@
 
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked()V
 
-    goto :goto_37
+    goto :goto_38
 
     :cond_81
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isShowing()Z
@@ -2796,12 +2825,12 @@
 
     invoke-virtual {v0, v4}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->doKeyguardLocked(Landroid/os/Bundle;)V
 
-    goto :goto_36
+    goto :goto_37
 
     :cond_82
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked()V
 
-    :goto_36
+    :goto_37
     iget-object v0, v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->pm:Landroid/os/PowerManager;
 
     invoke-static {}, Landroid/os/SystemClock;->uptimeMillis()J
@@ -2812,7 +2841,7 @@
 
     :catch_3
     :cond_83
-    :goto_37
+    :goto_38
     return-void
 
     :pswitch_data_0
diff --git a/smali/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali b/smali/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
index f9d4f628..73dd7ea2 100644
--- a/smali/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
+++ b/smali/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
@@ -104,7 +104,7 @@
 
     const/4 v1, -0x1
 
-    const/4 v2, 0x0
+    const/4 v2, 0x1
 
     if-ne v0, v1, :cond_0
 
@@ -113,23 +113,24 @@
     :cond_0
     sget v0, Lcom/android/systemui/util/DeviceType;->supportOpticalFingerprint:I
 
-    const/4 v1, 0x1
-
-    if-ne v0, v1, :cond_1
+    if-ne v0, v2, :cond_1
 
-    move v2, v1
+    goto :goto_0
 
     :cond_1
+    const/4 v2, 0x0
+
+    :goto_0
     if-eqz v2, :cond_2
 
     const v0, 0x3d8f5c29    # 0.07f
 
-    goto :goto_0
+    goto :goto_1
 
     :cond_2
     const v0, 0x3e0ccccd    # 0.1375f
 
-    :goto_0
+    :goto_1
     sput v0, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->BLUR_AMOUNT:F
 
     const/16 v0, 0x1388
@@ -390,8 +391,17 @@
 
     iput v0, p1, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
 
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean v1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v1, :cond_1
+
+    const/high16 v1, 0x20000
+
+    or-int/2addr v0, v1
+
+    iput v0, p1, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
 
+    :cond_1
     invoke-virtual {p0}, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->getCurrentState()Lcom/android/systemui/shade/NotificationShadeWindowState;
 
     move-result-object v0
@@ -400,7 +410,7 @@
 
     const/4 v2, 0x1
 
-    if-ne v1, v2, :cond_1
+    if-ne v1, v2, :cond_2
 
     iget-wide v0, v0, Lcom/android/systemui/shade/NotificationShadeWindowState;->keyguardUserActivityTimeout:J
 
@@ -408,16 +418,16 @@
 
     cmp-long v5, v0, v3
 
-    if-gez v5, :cond_2
+    if-gez v5, :cond_3
 
     move-wide v0, v3
 
     goto :goto_1
 
-    :cond_1
+    :cond_2
     const-wide/16 v0, -0x1
 
-    :cond_2
+    :cond_3
     :goto_1
     iput-wide v0, p1, Landroid/view/WindowManager$LayoutParams;->userActivityTimeout:J
 
diff --git a/smali_classes2/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali b/smali_classes2/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
index a46bad35..be098234 100644
--- a/smali_classes2/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
+++ b/smali_classes2/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
@@ -8280,19 +8280,30 @@
 
     iput v5, v2, Landroid/view/InsetsFlags;->behavior:I
 
-    sget-object v2, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
+    if-eqz v2, :cond_42
+
+    iget v2, v0, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
+
+    const/high16 v5, 0x20000
+
+    or-int/2addr v2, v5
+
+    iput v2, v0, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
+
+    :cond_42
     iget-object v2, v9, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mIndicatorCutoutUtil:Lcom/android/systemui/statusbar/phone/IndicatorCutoutUtil;
 
     iget-boolean v2, v2, Lcom/android/systemui/statusbar/phone/IndicatorCutoutUtil;->isUDCModel:Z
 
-    if-eqz v2, :cond_42
+    if-eqz v2, :cond_43
 
     const/16 v2, 0x2000
 
     invoke-virtual {v0, v2}, Landroid/view/WindowManager$LayoutParams;->semAddExtensionFlags(I)V
 
-    :cond_42
+    :cond_43
     iget-object v0, v9, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mNotificationShadeView:Landroid/view/ViewGroup;
 
     iget-object v2, v9, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mLp:Landroid/view/WindowManager$LayoutParams;
@@ -8315,7 +8326,7 @@
 
     move-result v0
 
-    if-eqz v0, :cond_43
+    if-eqz v0, :cond_44
 
     iget-object v0, v9, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mCurrentState:Lcom/android/systemui/shade/NotificationShadeWindowState;
 
@@ -8327,7 +8338,7 @@
 
     goto :goto_12
 
-    :cond_43
+    :cond_44
     const/4 v2, 0x1
 
     :goto_12
@@ -8339,7 +8350,7 @@
 
     iget-object v5, v2, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->pluginLockMediator:Lcom/android/systemui/pluginlock/PluginLockMediator;
 
-    if-eqz v5, :cond_45
+    if-eqz v5, :cond_46
 
     iget-object v6, v2, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->notificationShadeView:Landroid/view/ViewGroup;
 
@@ -8353,7 +8364,7 @@
 
     iget-object v7, v5, Lcom/android/systemui/pluginlock/PluginLockMediatorImpl;->mSPluginManager:Lcom/samsung/systemui/splugins/SPluginManager;
 
-    if-eqz v7, :cond_44
+    if-eqz v7, :cond_45
 
     const-class v9, Lcom/samsung/systemui/splugins/pluginlock/PluginLock;
 
@@ -8361,10 +8372,10 @@
 
     invoke-interface {v7, v5, v9, v10}, Lcom/samsung/systemui/splugins/SPluginManager;->addPluginListener(Lcom/samsung/systemui/splugins/SPluginListener;Ljava/lang/Class;Z)V
 
-    :cond_44
+    :cond_45
     iget-object v5, v5, Lcom/android/systemui/pluginlock/PluginLockMediatorImpl;->mSPluginListener:Lcom/android/systemui/pluginlock/PluginLockManagerImpl;
 
-    if-eqz v5, :cond_45
+    if-eqz v5, :cond_46
 
     new-instance v7, Ljava/lang/StringBuilder;
 
@@ -8392,7 +8403,7 @@
 
     iput-object v6, v5, Lcom/android/systemui/pluginlock/PluginLockDelegateApp;->mRootView:Landroid/view/ViewGroup;
 
-    :cond_45
+    :cond_46
     new-instance v5, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl$attach$1;
 
     invoke-direct {v5, v2}, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl$attach$1;-><init>(Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;)V
@@ -8449,7 +8460,7 @@
 
     iget-object v2, v2, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mWallpaperView:Lcom/android/systemui/wallpaper/view/SystemUIWallpaperBase;
 
-    if-eqz v2, :cond_46
+    if-eqz v2, :cond_47
 
     instance-of v2, v2, Lcom/android/systemui/wallpaper/view/KeyguardImageWallpaper;
 
@@ -8459,7 +8470,7 @@
 
     invoke-virtual {v0, v2}, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl$$ExternalSyntheticLambda11;->accept(Ljava/lang/Object;)V
 
-    :cond_46
+    :cond_47
     iget-object v0, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mStatusBarWindowController:Lcom/android/systemui/statusbar/window/StatusBarWindowController;
 
     invoke-virtual {v0}, Ljava/lang/Object;->getClass()Ljava/lang/Class;
@@ -8493,7 +8504,7 @@
     const/4 v13, 0x0
 
     :goto_13
-    if-gt v13, v5, :cond_47
+    if-gt v13, v5, :cond_48
 
     iget-object v5, v2, Landroid/view/WindowManager$LayoutParams;->paramsForRotation:[Landroid/view/WindowManager$LayoutParams;
 
@@ -8509,7 +8520,7 @@
 
     goto :goto_13
 
-    :cond_47
+    :cond_48
     iput-object v2, v0, Lcom/android/systemui/statusbar/window/StatusBarWindowController;->mLp:Landroid/view/WindowManager$LayoutParams;
 
     invoke-static {}, Landroid/os/Trace;->endSection()V
@@ -8550,7 +8561,7 @@
 
     iget-boolean v0, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mWallpaperSupported:Z
 
-    if-eqz v0, :cond_48
+    if-eqz v0, :cond_49
 
     new-instance v0, Landroid/content/IntentFilter;
 
@@ -8568,7 +8579,7 @@
 
     invoke-virtual {v5, v4, v2}, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl$20;->onReceive(Landroid/content/Context;Landroid/content/Intent;)V
 
-    :cond_48
+    :cond_49
     invoke-virtual/range {p0 .. p0}, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->setUpPresenter()V
 
     move-object/from16 v0, v29
@@ -8581,11 +8592,11 @@
 
     and-int/2addr v2, v3
 
-    if-eqz v2, :cond_49
+    if-eqz v2, :cond_4a
 
     iget-boolean v2, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mTransientShown:Z
 
-    if-nez v2, :cond_49
+    if-nez v2, :cond_4a
 
     const/4 v2, 0x1
 
@@ -8595,7 +8606,7 @@
 
     invoke-virtual/range {p0 .. p0}, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->maybeUpdateBarMode()V
 
-    :cond_49
+    :cond_4a
     iget-object v5, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mCommandQueueCallbacks:Lcom/android/systemui/statusbar/phone/CentralSurfacesCommandQueueCallbacks;
 
     iget v6, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mDisplayId:I
@@ -8629,7 +8640,7 @@
     const/4 v13, 0x0
 
     :goto_14
-    if-ge v13, v2, :cond_4a
+    if-ge v13, v2, :cond_4b
 
     iget-object v3, v0, Lcom/android/internal/statusbar/RegisterStatusBarResult;->mIcons:Landroid/util/ArrayMap;
 
@@ -8655,7 +8666,7 @@
 
     goto :goto_14
 
-    :cond_4a
+    :cond_4b
     new-instance v9, Landroid/content/IntentFilter;
 
     invoke-direct {v9}, Landroid/content/IntentFilter;-><init>()V
@@ -8682,7 +8693,7 @@
 
     iget-boolean v2, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mWallpaperSupported:Z
 
-    if-eqz v2, :cond_4b
+    if-eqz v2, :cond_4c
 
     const-string/jumbo v2, "wallpaper"
 
@@ -8704,7 +8715,7 @@
     .catch Landroid/os/RemoteException; {:try_start_1 .. :try_end_1} :catch_1
 
     :catch_1
-    :cond_4b
+    :cond_4c
     iget-object v2, v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mIconPolicy:Lcom/android/systemui/statusbar/phone/PhoneStatusBarPolicy;
 
     invoke-virtual {v2}, Lcom/android/systemui/statusbar/phone/PhoneStatusBarPolicy;->init()V
@@ -8785,7 +8796,7 @@
 
     iget-boolean v2, v0, Lcom/android/systemui/InitController;->mTasksExecuted:Z
 
-    if-nez v2, :cond_4c
+    if-nez v2, :cond_4d
 
     iget-object v0, v0, Lcom/android/systemui/InitController;->mTasks:Ljava/util/ArrayList;
 
@@ -8835,7 +8846,7 @@
 
     return-void
 
-    :cond_4c
+    :cond_4d
     new-instance v0, Ljava/lang/IllegalStateException;
 
     const-string v1, "post init tasks have already been executed!"
diff --git a/smali_classes2/com/android/systemui/statusbar/phone/SecLsScrimControlHelper$1.smali b/smali_classes2/com/android/systemui/statusbar/phone/SecLsScrimControlHelper$1.smali
index 412dff71..f8dff5b1 100644
--- a/smali_classes2/com/android/systemui/statusbar/phone/SecLsScrimControlHelper$1.smali
+++ b/smali_classes2/com/android/systemui/statusbar/phone/SecLsScrimControlHelper$1.smali
@@ -30,7 +30,11 @@
     goto :goto_0
 
     :cond_0
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_1
 
     iget-object p0, p0, Lcom/android/systemui/statusbar/phone/SecLsScrimControlHelper$1;->this$0:Lcom/android/systemui/statusbar/phone/SecLsScrimControlHelper;
 
diff --git a/smali_classes2/com/android/systemui/statusbar/phone/SecLsScrimControlHelper.smali b/smali_classes2/com/android/systemui/statusbar/phone/SecLsScrimControlHelper.smali
index 318ca963..474835fc 100644
--- a/smali_classes2/com/android/systemui/statusbar/phone/SecLsScrimControlHelper.smali
+++ b/smali_classes2/com/android/systemui/statusbar/phone/SecLsScrimControlHelper.smali
@@ -359,7 +359,11 @@
 
     if-eqz v0, :cond_2
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_2
 
     move v0, v1
 
@@ -404,7 +408,7 @@
 
     if-ne v0, v4, :cond_5
 
-    sput v2, Lcom/android/systemui/util/DeviceType;->supportOpticalFingerprint:I
+    sput v1, Lcom/android/systemui/util/DeviceType;->supportOpticalFingerprint:I
 
     :cond_5
     sget v0, Lcom/android/systemui/util/DeviceType;->supportOpticalFingerprint:I
diff --git a/smali_classes2/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManager.smali b/smali_classes2/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManager.smali
index fada9247..09e0e231 100644
--- a/smali_classes2/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManager.smali
+++ b/smali_classes2/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManager.smali
@@ -3917,7 +3917,11 @@
     :cond_11
     if-eqz v10, :cond_14
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v14
+
+    if-eqz v14, :cond_14
 
     invoke-virtual {v13}, Ljava/lang/Object;->getClass()Ljava/lang/Class;
 
diff --git a/smali_classes2/com/android/systemui/util/DeviceState.smali b/smali_classes2/com/android/systemui/util/DeviceState.smali
index 862238f6..42d96e35 100644
--- a/smali_classes2/com/android/systemui/util/DeviceState.smali
+++ b/smali_classes2/com/android/systemui/util/DeviceState.smali
@@ -517,7 +517,7 @@
     return p0
 .end method
 
-.method public static isCapturedBlurAllowed()V
+.method public static isCapturedBlurAllowed()Z
     .locals 2
 
     sget-object v0, Lcom/android/systemui/util/DeviceState;->sDisplaySize:Landroid/graphics/Point;
@@ -539,9 +539,37 @@
     invoke-virtual {v0, v1}, Lcom/samsung/android/view/SemWindowManager;->getInitialDisplaySize(Landroid/graphics/Point;)V
 
     :cond_0
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_CONFIG_CARRIER_TEXT_POLICY:Ljava/lang/String;
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    return-void
+    if-eqz v0, :cond_2
+
+    sget-object v0, Lcom/android/systemui/util/DeviceState;->sDisplaySize:Landroid/graphics/Point;
+
+    iget v1, v0, Landroid/graphics/Point;->x:I
+
+    iget v0, v0, Landroid/graphics/Point;->y:I
+
+    invoke-static {v1, v0}, Ljava/lang/Math;->min(II)I
+
+    move-result v0
+
+    const/16 v1, 0x2d0
+
+    if-le v0, v1, :cond_1
+
+    goto :goto_0
+
+    :cond_1
+    const/4 v0, 0x0
+
+    goto :goto_1
+
+    :cond_2
+    :goto_0
+    const/4 v0, 0x1
+
+    :goto_1
+    return v0
 .end method
 
 .method public static isCenterDisplayCutOut(Landroid/content/Context;)Z
diff --git a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$$ExternalSyntheticLambda1.smali b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$$ExternalSyntheticLambda1.smali
index 5913c833..38a223ba 100644
--- a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$$ExternalSyntheticLambda1.smali
+++ b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$$ExternalSyntheticLambda1.smali
@@ -126,7 +126,11 @@
 
     if-eqz v0, :cond_4
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_4
 
     iget-object v0, p0, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mWallpaperView:Lcom/android/systemui/wallpaper/view/SystemUIWallpaperBase;
 
diff --git a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$$ExternalSyntheticLambda7.smali b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$$ExternalSyntheticLambda7.smali
index 9e3b2463..697f1f07 100644
--- a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$$ExternalSyntheticLambda7.smali
+++ b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$$ExternalSyntheticLambda7.smali
@@ -202,7 +202,11 @@
 
     if-eqz v1, :cond_8
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v1
+
+    if-eqz v1, :cond_8
 
     iget-boolean v1, v0, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mIsBlurredViewAdded:Z
 
diff --git a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$2.smali b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$2.smali
index 967c1887..d04157aa 100644
--- a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$2.smali
+++ b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$2.smali
@@ -52,7 +52,11 @@
 
     if-eqz v0, :cond_0
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
 
     iget-object v0, p0, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mBlurredView:Lcom/android/systemui/wallpaper/view/KeyguardBlurredWallpaper;
 
diff --git a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$4.smali b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$4.smali
index 1a9e2353..c6e6e5f4 100644
--- a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$4.smali
+++ b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController$4.smali
@@ -840,7 +840,11 @@
 
     if-eqz p1, :cond_1c
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_1c
 
     iget-object p1, p0, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mWallpaperView:Lcom/android/systemui/wallpaper/view/SystemUIWallpaperBase;
 
@@ -914,7 +918,11 @@
 
     if-eqz p1, :cond_1e
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_1e
 
     iget-object p1, p0, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mWallpaperView:Lcom/android/systemui/wallpaper/view/SystemUIWallpaperBase;
 
diff --git a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController.smali b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController.smali
index 7396237c..87c17864 100644
--- a/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController.smali
+++ b/smali_classes2/com/android/systemui/wallpaper/KeyguardWallpaperController.smali
@@ -745,7 +745,11 @@
 
     if-eqz v0, :cond_4
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_4
 
     iget-object v0, p0, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mBlurredView:Lcom/android/systemui/wallpaper/view/KeyguardBlurredWallpaper;
 
@@ -2429,7 +2433,11 @@
 
     if-eqz v0, :cond_3
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_3
 
     iput-boolean v6, p0, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mWallpaperChanged:Z
 
@@ -2862,7 +2870,11 @@
 
     if-eqz v0, :cond_6
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_6
 
     invoke-virtual {v7, v15}, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->handleDlsViewModeDelayed(I)V
 
@@ -2921,7 +2933,11 @@
 
     if-eqz v0, :cond_a
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_a
 
     iget-boolean v0, v7, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mIsBlurredViewAdded:Z
 
@@ -3524,7 +3540,11 @@
 
     if-eqz v0, :cond_14
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_14
 
     move/from16 v15, v24
 
@@ -5289,7 +5309,11 @@
 
     if-eqz v0, :cond_1
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_1
 
     iget-boolean v0, p0, Lcom/android/systemui/wallpaper/KeyguardWallpaperController;->mOccluded:Z
 
diff --git a/smali_classes2/com/android/systemui/wallpaper/view/KeyguardAnimatedWallpaper.smali b/smali_classes2/com/android/systemui/wallpaper/view/KeyguardAnimatedWallpaper.smali
index 2878d875..d9c846c7 100644
--- a/smali_classes2/com/android/systemui/wallpaper/view/KeyguardAnimatedWallpaper.smali
+++ b/smali_classes2/com/android/systemui/wallpaper/view/KeyguardAnimatedWallpaper.smali
@@ -665,7 +665,11 @@
 
     if-eqz p1, :cond_1
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_1
 
     iget-object p1, p0, Lcom/android/systemui/wallpaper/view/SystemUIWallpaper;->mWallpaperResultCallback:Lcom/android/systemui/wallpaper/WallpaperResultCallback;
 
diff --git a/smali_classes2/com/android/systemui/wallpaper/view/KeyguardImageWallpaper.smali b/smali_classes2/com/android/systemui/wallpaper/view/KeyguardImageWallpaper.smali
index 23fd5250..c6dc37b9 100644
--- a/smali_classes2/com/android/systemui/wallpaper/view/KeyguardImageWallpaper.smali
+++ b/smali_classes2/com/android/systemui/wallpaper/view/KeyguardImageWallpaper.smali
@@ -2469,7 +2469,11 @@
 
     if-eqz v1, :cond_19
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v1
+
+    if-eqz v1, :cond_19
 
     iget-object v0, v0, Lcom/android/systemui/wallpaper/view/SystemUIWallpaper;->mWallpaperResultCallback:Lcom/android/systemui/wallpaper/WallpaperResultCallback;
 
diff --git a/smali_classes2/com/android/systemui/wallpaper/view/KeyguardVideoWallpaper.smali b/smali_classes2/com/android/systemui/wallpaper/view/KeyguardVideoWallpaper.smali
index 3825ba82..e2c5acca 100644
--- a/smali_classes2/com/android/systemui/wallpaper/view/KeyguardVideoWallpaper.smali
+++ b/smali_classes2/com/android/systemui/wallpaper/view/KeyguardVideoWallpaper.smali
@@ -1663,7 +1663,11 @@
 
     if-eqz p1, :cond_0
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_0
 
     iget-boolean p1, p0, Lcom/android/systemui/wallpaper/view/KeyguardVideoWallpaper;->mIsBlurEnabled:Z
 
@@ -2277,7 +2281,11 @@
 
     if-eqz v3, :cond_2
 
-    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()V
+    invoke-static {}, Lcom/android/systemui/util/DeviceState;->isCapturedBlurAllowed()Z
+
+    move-result v3
+
+    if-eqz v3, :cond_2
 
     if-eqz v0, :cond_1
 
-- 
2.43.0

